<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with the CUDA Quantum IR &mdash; NVIDIA CUDA Quantum  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-thebe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/codemirror.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/eclipse.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/tabs.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
        <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Create your Own CUDA Quantum Compiler Pass" href="mlir_pass.html" />
    <link rel="prev" title="CUDA Quantum and CMake" href="cmake_app.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #76b900" > 

          
          
          <a href="../../index.html" class="icon icon-home">
            NVIDIA CUDA Quantum
          </a>
              <div class="version">
                amd64-docs-experimental
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    /* override table width restrictions */
    .wy-table-responsive table td, .wy-table-responsive table th {
        white-space: normal;
    }

    .wy-table-responsive {
        margin-bottom: 24px;
        max-width: 100%;
        overflow: visible;
    }
  </style>
  
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">   Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#docker-image">Docker Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#install-the-docker-image">Install the Docker Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-a-terminal">Use CUDA Quantum in a Terminal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#use-cuda-quantum-in-vs-code">Use CUDA Quantum in VS Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#python-wheels">Python wheels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#building-from-source">Building from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#dependencies-and-compatibility">Dependencies and Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cudaq.html">   Learn the Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/prereqs.html">CUDA Quantum Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/compiling.html">Compiling CUDA Quantum Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/kernel.html">What is a CUDA Quantum Kernel?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/allocating_quantum_memory.html">Allocating Quantum Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/runtime_v_compile.html">Runtime Versus Compile-time Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/generic_functions.html">Generic Library Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/builder.html">Creating Kernels at Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/variational.html">Variational Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/platform.html">Multi-processor Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cudaq/platform.html#asynchronous-expectation-value-computations">Asynchronous expectation value computations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cudaq/platform.html#parallel-distribution-mode">Parallel distribution mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cudaq/platform.html#c">C++</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cudaq/platform.html#python">Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cudaq/verbose_out.html">Debugging and Verbose Logging</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../advanced.html">   Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nvqir_simulator.html">Create a new NVQIR Simulator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="nvqir_simulator.html#circuitsimulator"><code class="code docutils literal notranslate"><span class="pre">CircuitSimulator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="nvqir_simulator.html#let-s-see-this-in-action">Letâ€™s see this in action</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cmake_app.html">Downstream CMake Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Working with CUDA Quantum IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlir_pass.html">Create an MLIR Pass for CUDA Quantum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">   Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cpp.html">   CUDA Quantum in C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#computing-expectation-values">Computing Expectation Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#multi-control-synthesis">Multi-control Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#simulations-with-cuquantum">Simulations with cuQuantum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp.html#using-quantum-hardware-providers">Using Quantum Hardware Providers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python.html">   CUDA Quantum in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../python.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#bernstein-vazirani">Bernstein-Vazirani</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#variational-quantum-eigensolver">Variational Quantum Eigensolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#quantum-approximate-optimization-algorithm">Quantum Approximate Optimization Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#noisy-simulation">Noisy Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python.html#using-quantum-hardware-providers">Using Quantum Hardware Providers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">   Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/executing_circuits.html">Executing Quantum Circuits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/executing_circuits.html#Sample">Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/executing_circuits.html#Observe">Observe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/single_qubit_rotation.html">Single Qubit Rotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/noisy_simulations.html">Noisy Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/vqe.html">Variational Quantum Eigensolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/hybrid_qnns.html">Hybrid Quantum Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html">Multi-GPU Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html#Available-Targets">Available Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html#Default-CPU-Backend">Default CPU Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html#Acceleration-via-NVIDIA-GPUs">Acceleration via NVIDIA GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html#Multiple-NVIDIA-GPUs">Multiple NVIDIA GPUs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/python/tutorials/multi_gpu_workflows.html#Multiple-QPU's">Multiple QPUâ€™s</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulators.html">   Simulator Backends</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulators.html#state-vector-simulators">State Vector Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#cuquantum-single-gpu">cuQuantum single-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#cuquantum-multi-node-multi-gpu">cuQuantum multi-node multi-GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#openmp-cpu-only">OpenMP CPU-only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../simulators.html#tensor-network-simulators">Tensor Network Simulators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../simulators.html#id1">cuQuantum multi-node multi-GPU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../hardware.html">   Hardware Backends</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../hardware.html#quantinuum">Quantinuum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#setting-credentials">Setting Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#submission-from-c">Submission from C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#submission-from-python">Submission from Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hardware.html#ionq">IonQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id1">Setting Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id2">Submission from C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id3">Submission from Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hardware.html#iqm">IQM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id4">Setting Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id5">Submission from C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware.html#id6">Submission from Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../specification/index.html">   Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../specification/cudaq.html">   Language Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/machine_model.html">1. Machine Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/namespace.html">2. Namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/types.html">3. Quantum Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#cudaq-qudit-levels">3.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::qudit&lt;Levels&gt;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#cudaq-qubit">3.2. <code class="code docutils literal notranslate"><span class="pre">cudaq::qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/types.html#quantum-containers">3.3. Quantum Containers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/operators.html">4. Quantum Operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/operators.html#cudaq-spin-op">4.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::spin_op</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/operations.html">5. Quantum Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/kernels.html">6. Quantum Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/kernels.html#kernel-composability">6.1. Kernel Composability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/kernels.html#allowed-kernel-classical-function-invocations">6.2. Allowed Kernel Classical Function Invocations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/synthesis.html">7. Sub-circuit Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/control_flow.html">8. Control Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/dynamic_kernels.html">9. Just-in-Time Kernel Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/patterns.html">10. Quantum Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/patterns.html#compute-action-uncompute">10.1. Compute-Action-Uncompute</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/platform.html">11. Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html">12. Algorithmic Primitives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-sample">12.1. <code class="code docutils literal notranslate"><span class="pre">cudaq::sample</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-observe">12.2. <code class="code docutils literal notranslate"><span class="pre">cudaq::observe</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-optimizer">12.3. <code class="code docutils literal notranslate"><span class="pre">cudaq::optimizer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/algorithmic_primitives.html#cudaq-gradient">12.4. <code class="code docutils literal notranslate"><span class="pre">cudaq::gradient</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/cudaq/examples.html">13. Example Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#hello-world-simple-bell-state">13.1. Hello World - Simple Bell State</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#ghz-state-preparation-and-sampling">13.2. GHZ State Preparation and Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#quantum-phase-estimation">13.3. Quantum Phase Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#deuteron-binding-energy-parameter-sweep">13.4. Deuteron Binding Energy Parameter Sweep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#grover-s-algorithm">13.5. Groverâ€™s Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../specification/cudaq/examples.html#iterative-phase-estimation">13.6. Iterative Phase Estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../specification/quake-dialect.html">   Quake Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../specification/quake-dialect.html#general-introduction">General Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../specification/quake-dialect.html#motivation">Motivation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">   API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/cpp_api.html">C++ API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#operators">Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#quantum">Quantum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#common">Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#noise-modeling">Noise Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#kernel-builder">Kernel Builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#algorithms">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#platform">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/cpp_api.html#namespaces">Namespaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/languages/python_api.html">Python API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#program-construction">Program Construction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.make_kernel"><code class="docutils literal notranslate"><span class="pre">make_kernel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.from_state"><code class="docutils literal notranslate"><span class="pre">from_state()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.Kernel"><code class="docutils literal notranslate"><span class="pre">Kernel</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#kernel-execution">Kernel Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample"><code class="docutils literal notranslate"><span class="pre">sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.sample_async"><code class="docutils literal notranslate"><span class="pre">sample_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe"><code class="docutils literal notranslate"><span class="pre">observe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.observe_async"><code class="docutils literal notranslate"><span class="pre">observe_async()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.vqe"><code class="docutils literal notranslate"><span class="pre">vqe()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#backend-configuration">Backend Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.has_target"><code class="docutils literal notranslate"><span class="pre">has_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.get_target"><code class="docutils literal notranslate"><span class="pre">get_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.get_targets"><code class="docutils literal notranslate"><span class="pre">get_targets()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_target"><code class="docutils literal notranslate"><span class="pre">set_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.reset_target"><code class="docutils literal notranslate"><span class="pre">reset_target()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_noise"><code class="docutils literal notranslate"><span class="pre">set_noise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.unset_noise"><code class="docutils literal notranslate"><span class="pre">unset_noise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.initialize_cudaq"><code class="docutils literal notranslate"><span class="pre">initialize_cudaq()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.num_available_gpus"><code class="docutils literal notranslate"><span class="pre">num_available_gpus()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.set_random_seed"><code class="docutils literal notranslate"><span class="pre">set_random_seed()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#data-types">Data Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.Target"><code class="docutils literal notranslate"><span class="pre">Target</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.QuakeValue"><code class="docutils literal notranslate"><span class="pre">QuakeValue</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qubit"><code class="docutils literal notranslate"><span class="pre">qubit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.qreg"><code class="docutils literal notranslate"><span class="pre">qreg</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.ComplexMatrix"><code class="docutils literal notranslate"><span class="pre">ComplexMatrix</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SpinOperator"><code class="docutils literal notranslate"><span class="pre">SpinOperator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.i"><code class="docutils literal notranslate"><span class="pre">spin.i()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.x"><code class="docutils literal notranslate"><span class="pre">spin.x()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.y"><code class="docutils literal notranslate"><span class="pre">spin.y()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.spin.z"><code class="docutils literal notranslate"><span class="pre">spin.z()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.SampleResult"><code class="docutils literal notranslate"><span class="pre">SampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncSampleResult"><code class="docutils literal notranslate"><span class="pre">AsyncSampleResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.ObserveResult"><code class="docutils literal notranslate"><span class="pre">ObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.AsyncObserveResult"><code class="docutils literal notranslate"><span class="pre">AsyncObserveResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.OptimizationResult"><code class="docutils literal notranslate"><span class="pre">OptimizationResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#optimizers">Optimizers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#gradients">Gradients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#noisy-simulation">Noisy Simulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/languages/python_api.html#mpi-submodule">MPI Submodule</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.initialize"><code class="docutils literal notranslate"><span class="pre">initialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.rank"><code class="docutils literal notranslate"><span class="pre">rank()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.num_ranks"><code class="docutils literal notranslate"><span class="pre">num_ranks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.all_gather"><code class="docutils literal notranslate"><span class="pre">all_gather()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.is_initialized"><code class="docutils literal notranslate"><span class="pre">is_initialized()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/languages/python_api.html#cudaq.mpi.finalize"><code class="docutils literal notranslate"><span class="pre">finalize()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/default_ops.html">Quantum Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/default_ops.html#unitary-operations-on-qubits">Unitary Operations on Qubits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#x"><code class="code docutils literal notranslate"><span class="pre">x</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#y"><code class="code docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#z"><code class="code docutils literal notranslate"><span class="pre">z</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#h"><code class="code docutils literal notranslate"><span class="pre">h</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#r1"><code class="code docutils literal notranslate"><span class="pre">r1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#rx"><code class="code docutils literal notranslate"><span class="pre">rx</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#ry"><code class="code docutils literal notranslate"><span class="pre">ry</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#rz"><code class="code docutils literal notranslate"><span class="pre">rz</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#s"><code class="code docutils literal notranslate"><span class="pre">s</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#t"><code class="code docutils literal notranslate"><span class="pre">t</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#swap"><code class="code docutils literal notranslate"><span class="pre">swap</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/default_ops.html#adjoint-and-controlled-operations">Adjoint and Controlled Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/default_ops.html#measurements-on-qubits">Measurements on Qubits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#mz"><code class="code docutils literal notranslate"><span class="pre">mz</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#mx"><code class="code docutils literal notranslate"><span class="pre">mx</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/default_ops.html#my"><code class="code docutils literal notranslate"><span class="pre">my</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">   Other Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #76b900" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NVIDIA CUDA Quantum</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../advanced.html">Advanced CUDA Quantum Topics</a></li>
      <li class="breadcrumb-item active">Working with the CUDA Quantum IR</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/using/advanced/cudaq_ir.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="cmake_app.html" class="btn btn-neutral float-left" title="CUDA Quantum and CMake" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mlir_pass.html" class="btn btn-neutral float-right" title="Create your Own CUDA Quantum Compiler Pass" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-the-cuda-quantum-ir">
<h1>Working with the CUDA Quantum IR<a class="headerlink" href="#working-with-the-cuda-quantum-ir" title="Permalink to this heading">Â¶</a></h1>
<p>Letâ€™s see the output of <code class="code docutils literal notranslate"><span class="pre">nvq++</span></code> in verbose mode. Given a simple code like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cudaq.h&gt;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">ghz</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">__qpu__</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cudaq</span><span class="o">::</span><span class="n">qreg</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
<span class="w">    </span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">x</span><span class="o">&lt;</span><span class="n">cudaq</span><span class="o">::</span><span class="n">ctrl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">mz</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>saved to file <code class="code docutils literal notranslate"><span class="pre">simple.cpp</span></code>, we see the following output from <code class="code docutils literal notranslate"><span class="pre">nvq++</span></code> verbose mode (up to some absolute paths)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nvq++<span class="w"> </span>simple.cpp<span class="w"> </span>-v<span class="w"> </span>--save-temps

<span class="go">cudaq-quake --emit-llvm-file simple.cpp -o simple.qke</span>
<span class="go">cudaq-opt --pass-pipeline=builtin.module(canonicalize,lambda-lifting,canonicalize,apply-op-specialization,kernel-execution,inline{default-pipeline=func.func(indirect-to-direct-calls)},func.func(quake-add-metadata),device-code-loader{use-quake=1},expand-measurements,func.func(lower-to-cfg),canonicalize,cse) simple.qke -o simple.qke.LpsXpu</span>
<span class="go">cudaq-translate --convert-to=qir simple.qke.LpsXpu -o simple.ll.p3De4L</span>
<span class="go">fixup-linkage.pl simple.qke simple.ll</span>
<span class="go">llc --relocation-model=pic --filetype=obj -O2 simple.ll.p3De4L -o simple.qke.o</span>
<span class="go">llc --relocation-model=pic --filetype=obj -O2 simple.ll -o simple.classic.o</span>
<span class="go">clang++ -L/usr/lib/gcc/x86_64-linux-gnu/12 -L/usr/lib64 -L/lib/x86_64-linux-gnu -L/lib64 -L/usr/lib/x86_64-linux-gnu -L/lib -L/usr/lib -L/usr/local/cuda/lib64/stubs -r simple.qke.o simple.classic.o -o simple.o</span>
<span class="go">clang++ -Wl,-rpath,lib -Llib -L/usr/lib/gcc/x86_64-linux-gnu/12 -L/usr/lib64 -L/lib/x86_64-linux-gnu -L/lib64 -L/usr/lib/x86_64-linux-gnu -L/lib -L/usr/lib -L/usr/local/cuda/lib64/stubs simple.o -lcudaq -lcudaq-common -lcudaq-mlir-runtime -lcudaq-builder -lcudaq-ensmallen -lcudaq-nlopt -lcudaq-spin -lcudaq-em-default -lcudaq-platform-default -lnvqir -lnvqir-qpp</span>
</pre></div>
</div>
<p>The workflow orchestrated above is best visualized in the following figure.</p>
<img alt="../../_images/nvqpp_workflow.png" src="../../_images/nvqpp_workflow.png" />
<p>We start by mapping CUDA Quantum C++ kernel representations (structs, lambdas, and free functions)
to the Quake dialect. Since we added <code class="code docutils literal notranslate"><span class="pre">--save-temps</span></code>,
we can look at the IR code that was produced. <code class="code docutils literal notranslate"><span class="pre">simple.qke</span></code> contains</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">module attributes {qtx.mangled_name_map = {__nvqpp__mlirgen__ghz = &quot;_ZN3ghzclEi&quot;}} {</span>
<span class="go">    func.func @__nvqpp__mlirgen__ghz(%arg0: i32) attributes {&quot;cudaq-entrypoint&quot;, &quot;cudaq-kernel&quot;} {</span>
<span class="gp">       %</span><span class="nv">alloca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.alloca<span class="o">()</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="go">       memref.store %arg0, %alloca[] : memref&lt;i32&gt;</span>
<span class="gp">       %</span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">       %</span><span class="nv">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.extsi<span class="w"> </span>%0<span class="w"> </span>:<span class="w"> </span>i32<span class="w"> </span>to<span class="w"> </span>i64
<span class="gp">       %</span><span class="nv">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quake.alloca<span class="o">(</span>%1<span class="w"> </span>:<span class="w"> </span>i64<span class="o">)</span><span class="w"> </span>!quake.veq&lt;?&gt;
<span class="gp">       %</span><span class="nv">c0_i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.constant<span class="w"> </span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">       %</span><span class="nv">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.extsi<span class="w"> </span>%c0_i32<span class="w"> </span>:<span class="w"> </span>i32<span class="w"> </span>to<span class="w"> </span>i64
<span class="gp">       %</span><span class="nv">4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quake.extract_ref<span class="w"> </span>%2<span class="o">[</span>%3<span class="o">]</span><span class="w"> </span>:<span class="w"> </span><span class="o">(</span>!quake.veq&lt;?&gt;,<span class="w"> </span>i64<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>!quake.ref
<span class="go">       quake.h %4 : (!quake.ref) -&gt; ()</span>
<span class="go">       cc.scope {</span>
<span class="gp">        %</span><span class="nv">c0_i32_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.constant<span class="w"> </span><span class="m">0</span><span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">        %</span><span class="nv">alloca_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.alloca<span class="o">()</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="go">        memref.store %c0_i32_0, %alloca_1[] : memref&lt;i32&gt;</span>
<span class="go">        cc.loop while {</span>
<span class="gp">            %</span><span class="nv">6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca_1<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">            %</span><span class="nv">7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">            %</span><span class="nv">c1_i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.constant<span class="w"> </span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">            %</span><span class="nv">8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.subi<span class="w"> </span>%7,<span class="w"> </span>%c1_i32<span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">            %</span><span class="nv">9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.cmpi<span class="w"> </span>slt,<span class="w"> </span>%6,<span class="w"> </span>%8<span class="w"> </span>:<span class="w"> </span>i32
<span class="go">            cc.condition %9</span>
<span class="go">        } do {</span>
<span class="go">          cc.scope {</span>
<span class="gp">            %</span><span class="nv">6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca_1<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">            %</span><span class="nv">7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.extsi<span class="w"> </span>%6<span class="w"> </span>:<span class="w"> </span>i32<span class="w"> </span>to<span class="w"> </span>i64
<span class="gp">            %</span><span class="nv">8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quake.extract_ref<span class="w"> </span>%2<span class="o">[</span>%7<span class="o">]</span><span class="w"> </span>:<span class="w"> </span><span class="o">(</span>!quake.veq&lt;?&gt;,<span class="w"> </span>i64<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>!quake.ref
<span class="gp">            %</span><span class="nv">9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca_1<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">            %</span><span class="nv">c1_i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.constant<span class="w"> </span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">            %</span><span class="nv">10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.addi<span class="w"> </span>%9,<span class="w"> </span>%c1_i32<span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">            %</span><span class="nv">11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.extsi<span class="w"> </span>%10<span class="w"> </span>:<span class="w"> </span>i32<span class="w"> </span>to<span class="w"> </span>i64
<span class="gp">            %</span><span class="nv">12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quake.extract_ref<span class="w"> </span>%2<span class="o">[</span>%11<span class="o">]</span><span class="w"> </span>:<span class="w"> </span><span class="o">(</span>!quake.veq&lt;?&gt;,<span class="w"> </span>i64<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>!quake.ref
<span class="go">            quake.x [%8] %12 : (!quake.ref, !quake.ref) -&gt; ()</span>
<span class="go">          }</span>
<span class="go">          cc.continue</span>
<span class="go">        } step {</span>
<span class="gp">            %</span><span class="nv">6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>memref.load<span class="w"> </span>%alloca_1<span class="o">[]</span><span class="w"> </span>:<span class="w"> </span>memref&lt;i32&gt;
<span class="gp">            %</span><span class="nv">c1_i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.constant<span class="w"> </span><span class="m">1</span><span class="w"> </span>:<span class="w"> </span>i32
<span class="gp">            %</span><span class="nv">7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>arith.addi<span class="w"> </span>%6,<span class="w"> </span>%c1_i32<span class="w"> </span>:<span class="w"> </span>i32
<span class="go">            memref.store %7, %alloca_1[] : memref&lt;i32&gt;</span>
<span class="go">        }</span>
<span class="go">        }</span>
<span class="gp">        %</span><span class="nv">5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>quake.mz<span class="w"> </span>%2<span class="w"> </span>:<span class="w"> </span><span class="o">(</span>!quake.veq&lt;?&gt;<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>!cc.stdvec&lt;i1&gt;
<span class="go">        return</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>This is the base Quake file, unoptimized and unchanged. It is produced by the
<code class="code docutils literal notranslate"><span class="pre">cudaq-quake</span></code> tool, which also allows us to output the full LLVM IR representation
for the code. This LLVM IR is classical-only, and is directly produced by <code class="code docutils literal notranslate"><span class="pre">clang++</span></code>
code-generation. The LLVM IR file <code class="code docutils literal notranslate"><span class="pre">simple.ll</span></code> contains the CUDA Quantum kernel
<code class="code docutils literal notranslate"><span class="pre">operator()(Args...)</span></code> LLVM function, with a mangled name. Ultimately, we
want to replace this function with our own MLIR-generated function.</p>
<p>Next, the <code class="code docutils literal notranslate"><span class="pre">cudaq-opt</span></code> tool is invoked on the <code class="code docutils literal notranslate"><span class="pre">simple.qke</span></code> file. This runs an
MLIR pass-pipeline that canonicalizes and optimizes the code. It will also process quantum
lambdas, lift those lambdas to functions, and synthesis adjoint and controlled versions of
CUDA Quantum kernel functions if necessary. The most important pass this this step applies is the
<code class="code docutils literal notranslate"><span class="pre">kernel-execution</span></code> pass, which synthesizes a new entry point LLVM function with the
same name and signature as the original <code class="code docutils literal notranslate"><span class="pre">operator()(Args...)</span></code> call function in the
classical <code class="code docutils literal notranslate"><span class="pre">simple.ll</span></code> file. We also extract all Quake code representations as strings
and register them with the CUDA Quantum runtime for runtime IR introspection.</p>
<p>After <code class="code docutils literal notranslate"><span class="pre">cudaq-opt</span></code>, the <code class="code docutils literal notranslate"><span class="pre">cudaq-translate</span></code> tool is used to lower the transformed
Quake representation to an LLVM IR representation, specifically the QIR. We finish by lowering
this representation to object code via standard LLVM tools (e.g. <code class="code docutils literal notranslate"><span class="pre">llc</span></code>), and merge all
object files into a single object file, ensuring that our new mangled <code class="code docutils literal notranslate"><span class="pre">operator()(Args...)</span></code>
call is injected first, thereby over-writing the original. Finally, based on user compile flags,
we configure the link line with specific libraries that implement the <code class="code docutils literal notranslate"><span class="pre">quantum_platform</span></code>
(here the <code class="code docutils literal notranslate"><span class="pre">libcudaq-platform-default.so</span></code>) and NVQIR circuit simulator backend (the
<code class="code docutils literal notranslate"><span class="pre">libnvqir-qpp.so</span></code> Q++ CPU-only simulation backend). These latter libraries are controlled
via the <code class="code docutils literal notranslate"><span class="pre">--platform</span></code> and <code class="code docutils literal notranslate"><span class="pre">--target</span></code> compiler flags.</p>
<img alt="../../_images/dialects.png" src="../../_images/dialects.png" />
<p>The above figure demonstrate the MLIR dialects involved and the overall workflow mapping
high-level language constructs to lower-level MLIR dialect code, and ultimately LLVM IR.</p>
<p>CUDA Quantum also provides value-semantics form of Quake for static circuit
representation. This dialect directly enables robust circuit
optimizations via data-flow analysis of the representative circuit. This dialect
is typically produced just-in-time when the structure of the circuit is fully known.</p>
<p>You will notice that there are a number of CUDA Quantum executable tools installed as part
of this open beta release. These tools are directly related to the generation,
processing, optimization, and lowering of the core <code class="code docutils literal notranslate"><span class="pre">nvq++</span></code> compiler representations.
The tools available are</p>
<ol class="arabic simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">cudaq-quake</span></code> - Lower C++ to Quake, can also output classical LLVM IR file</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">cudaq-opt</span></code> - Process Quake with various MLIR Passes</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">cudaq-translate</span></code> - Lower Quake to external representations like QIR</p></li>
</ol>
<p>CUDA Quantum and <code class="code docutils literal notranslate"><span class="pre">nvq++</span></code> rely on Quake for the core quantum intermediate representation.
Quake represents an IR closer to the CUDA Quantum source language and models qubits and
quantum instructions via memory semantics. Quake can be fully dynamic and in
that sense represents a quantum circuit template or generator. With runtime
arguments fully specified, Quake code can be used to generate or synthesize
a fully-known quantum circuit. The value semantics form of Quake can thus be
used as a representation for fully-known
or synthesized quantum circuits. Its utility, therefore, lies in its ability to
optimize quantum code. It departs from the memory semantics model of Quake and
expresses the flow of quantum information explicitly as MLIR values.
This approach makes it easier for finding circuit patterns and leveraging it for common
optimization tasks.</p>
<p>To demonstrate how these tools work together, letâ€™s take the simple GHZ CUDA Quantum
program and lower the kernel from C++ to Quake, synthesize that Quake code,
and produce QIR. Recall the code snippet for the kernel</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define a quantum kernel</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ghz</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="p">()()</span><span class="w"> </span><span class="n">__qpu__</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cudaq</span><span class="o">::</span><span class="n">qreg</span><span class="w"> </span><span class="nf">q</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="n">x</span><span class="o">&lt;</span><span class="n">cudaq</span><span class="o">::</span><span class="n">ctrl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">mz</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Using the toolchain, we can lower this to directly to QIR</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cudaq-quake simple.cpp | cudaq-opt --canonicalize | cudaq-translate --convert-to=qir</span>
</pre></div>
</div>
<p>which prints</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">; ModuleID = &#39;LLVMDialectModule&#39;</span>
<span class="go">source_filename = &quot;LLVMDialectModule&quot;</span>
<span class="go">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span>
<span class="go">target triple = &quot;x86_64-unknown-linux-gnu&quot;</span>

<span class="gp">%</span><span class="nv">Array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>opaque
<span class="gp">%</span><span class="nv">Qubit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>opaque
<span class="gp">%</span><span class="nv">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>opaque

<span class="go">declare void @invokeWithControlQubits(i64, void (%Array*, %Qubit*)*, ...) local_unnamed_addr</span>

<span class="go">declare void @__quantum__qis__x__ctl(%Array*, %Qubit*)</span>

<span class="go">declare %Result* @__quantum__qis__mz(%Qubit*) local_unnamed_addr</span>

<span class="go">declare void @__quantum__rt__qubit_release_array(%Array*) local_unnamed_addr</span>

<span class="go">declare i64 @__quantum__rt__array_get_size_1d(%Array*) local_unnamed_addr</span>

<span class="go">declare void @__quantum__qis__h(%Qubit*) local_unnamed_addr</span>

<span class="go">declare i8* @__quantum__rt__array_get_element_ptr_1d(%Array*, i64) local_unnamed_addr</span>

<span class="go">declare %Array* @__quantum__rt__qubit_allocate_array(i64) local_unnamed_addr</span>

<span class="go">define void @__nvqpp__mlirgen__ghz(i32 %0) local_unnamed_addr {</span>
<span class="gp">  %</span><span class="nv">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sext<span class="w"> </span>i32<span class="w"> </span>%0<span class="w"> </span>to<span class="w"> </span>i64
<span class="gp">  %</span><span class="nv">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>%Array*<span class="w"> </span>@__quantum__rt__qubit_allocate_array<span class="o">(</span>i64<span class="w"> </span>%2<span class="o">)</span>
<span class="gp">  %</span><span class="nv">4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>i8*<span class="w"> </span>@__quantum__rt__array_get_element_ptr_1d<span class="o">(</span>%Array*<span class="w"> </span>%3,<span class="w"> </span>i64<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="gp">  %</span><span class="nv">5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bitcast<span class="w"> </span>i8*<span class="w"> </span>%4<span class="w"> </span>to<span class="w"> </span>%Qubit**
<span class="gp">  %</span><span class="nv">6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>%Qubit*,<span class="w"> </span>%Qubit**<span class="w"> </span>%5,<span class="w"> </span>align<span class="w"> </span><span class="m">8</span>
<span class="go">  tail call void @__quantum__qis__h(%Qubit* %6)</span>
<span class="gp">  %</span><span class="nv">7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>add<span class="w"> </span>i32<span class="w"> </span>%0,<span class="w"> </span>-1
<span class="gp">  %</span><span class="nv">8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>sgt<span class="w"> </span>i32<span class="w"> </span>%7,<span class="w"> </span><span class="m">0</span>
<span class="go">  br i1 %8, label %.lr.ph.preheader, label %._crit_edge</span>

<span class="go">.lr.ph.preheader:                                 ; preds = %1</span>
<span class="gp">  %</span>wide.trip.count<span class="w"> </span><span class="o">=</span><span class="w"> </span>zext<span class="w"> </span>i32<span class="w"> </span>%7<span class="w"> </span>to<span class="w"> </span>i64
<span class="go">  br label %.lr.ph</span>

<span class="go">.lr.ph:                                           ; preds = %.lr.ph.preheader, %.lr.ph</span>
<span class="gp">  %</span>indvars.iv<span class="w"> </span><span class="o">=</span><span class="w"> </span>phi<span class="w"> </span>i64<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>%.lr.ph.preheader<span class="w"> </span><span class="o">]</span>,<span class="w"> </span><span class="o">[</span><span class="w"> </span>%indvars.iv.next,<span class="w"> </span>%.lr.ph<span class="w"> </span><span class="o">]</span>
<span class="gp">  %</span><span class="nv">9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>i8*<span class="w"> </span>@__quantum__rt__array_get_element_ptr_1d<span class="o">(</span>%Array*<span class="w"> </span>%3,<span class="w"> </span>i64<span class="w"> </span>%indvars.iv<span class="o">)</span>
<span class="gp">  %</span><span class="nv">10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bitcast<span class="w"> </span>i8*<span class="w"> </span>%9<span class="w"> </span>to<span class="w"> </span>%Qubit**
<span class="gp">  %</span><span class="nv">11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>%Qubit*,<span class="w"> </span>%Qubit**<span class="w"> </span>%10,<span class="w"> </span>align<span class="w"> </span><span class="m">8</span>
<span class="gp">  %</span>indvars.iv.next<span class="w"> </span><span class="o">=</span><span class="w"> </span>add<span class="w"> </span>nuw<span class="w"> </span>nsw<span class="w"> </span>i64<span class="w"> </span>%indvars.iv,<span class="w"> </span><span class="m">1</span>
<span class="gp">  %</span><span class="nv">12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>i8*<span class="w"> </span>@__quantum__rt__array_get_element_ptr_1d<span class="o">(</span>%Array*<span class="w"> </span>%3,<span class="w"> </span>i64<span class="w"> </span>%indvars.iv.next<span class="o">)</span>
<span class="gp">  %</span><span class="nv">13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bitcast<span class="w"> </span>i8*<span class="w"> </span>%12<span class="w"> </span>to<span class="w"> </span>%Qubit**
<span class="gp">  %</span><span class="nv">14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>%Qubit*,<span class="w"> </span>%Qubit**<span class="w"> </span>%13,<span class="w"> </span>align<span class="w"> </span><span class="m">8</span>
<span class="go">  tail call void (i64, void (%Array*, %Qubit*)*, ...) @invokeWithControlQubits(i64 1, void (%Array*, %Qubit*)* nonnull @__quantum__qis__x__ctl, %Qubit* %11, %Qubit* %14)</span>
<span class="gp">  %</span>exitcond.not<span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>eq<span class="w"> </span>i64<span class="w"> </span>%indvars.iv.next,<span class="w"> </span>%wide.trip.count
<span class="go">  br i1 %exitcond.not, label %._crit_edge, label %.lr.ph</span>

<span class="go">._crit_edge:                                      ; preds = %.lr.ph, %1</span>
<span class="gp">  %</span><span class="nv">15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>i64<span class="w"> </span>@__quantum__rt__array_get_size_1d<span class="o">(</span>%Array*<span class="w"> </span>%3<span class="o">)</span>
<span class="gp">  %</span><span class="nv">16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>sgt<span class="w"> </span>i64<span class="w"> </span>%15,<span class="w"> </span><span class="m">0</span>
<span class="go">  br i1 %16, label %.lr.ph3, label %._crit_edge4</span>

<span class="go">.lr.ph3:                                          ; preds = %._crit_edge, %.lr.ph3</span>
<span class="gp">  %</span><span class="nv">17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>phi<span class="w"> </span>i64<span class="w"> </span><span class="o">[</span><span class="w"> </span>%22,<span class="w"> </span>%.lr.ph3<span class="w"> </span><span class="o">]</span>,<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>%._crit_edge<span class="w"> </span><span class="o">]</span>
<span class="gp">  %</span><span class="nv">18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>i8*<span class="w"> </span>@__quantum__rt__array_get_element_ptr_1d<span class="o">(</span>%Array*<span class="w"> </span>%3,<span class="w"> </span>i64<span class="w"> </span>%17<span class="o">)</span>
<span class="gp">  %</span><span class="nv">19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bitcast<span class="w"> </span>i8*<span class="w"> </span>%18<span class="w"> </span>to<span class="w"> </span>%Qubit**
<span class="gp">  %</span><span class="nv">20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>%Qubit*,<span class="w"> </span>%Qubit**<span class="w"> </span>%19,<span class="w"> </span>align<span class="w"> </span><span class="m">8</span>
<span class="gp">  %</span><span class="nv">21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tail<span class="w"> </span>call<span class="w"> </span>%Result*<span class="w"> </span>@__quantum__qis__mz<span class="o">(</span>%Qubit*<span class="w"> </span>%20<span class="o">)</span>
<span class="gp">  %</span><span class="nv">22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>add<span class="w"> </span>nuw<span class="w"> </span>nsw<span class="w"> </span>i64<span class="w"> </span>%17,<span class="w"> </span><span class="m">1</span>
<span class="gp">  %</span>exitcond5.not<span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>eq<span class="w"> </span>i64<span class="w"> </span>%22,<span class="w"> </span>%15
<span class="go">  br i1 %exitcond5.not, label %._crit_edge4, label %.lr.ph3</span>

<span class="go">._crit_edge4:                                     ; preds = %.lr.ph3, %._crit_edge</span>
<span class="go">  tail call void @__quantum__rt__qubit_release_array(%Array* %3)</span>
<span class="go">  ret void</span>
<span class="go">}</span>

<span class="go">!llvm.module.flags = !{!0}</span>

<span class="go">!0 = !{i32 2, !&quot;Debug Info Version&quot;, i32 3}</span>
</pre></div>
</div>
<p>Note that the results of each tool can be piped to further tools, creating a
composable pipeline of compiler lowering tools.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "bettinaheim/cuda-quantum-binder",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "eclipse",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./using/advanced"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cmake_app.html" class="btn btn-neutral float-left" title="CUDA Quantum and CMake" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mlir_pass.html" class="btn btn-neutral float-right" title="Create your Own CUDA Quantum Compiler Pass" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NVIDIA Corporation &amp; Affiliates.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>  

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1);
    color: rgba(59,93,0,1);
    border-top: solid 3px rgba(59,93,0,1);
  }
  </style>

  <style>
  #interactive-frame {
    width: 100%;
    overflow: auto;
    resize: both;
    position: relative;
    z-index: 2;
  }
  iframe {
    width: 100%;
    aspect-ratio: 2 / 1;
    border: none;
  }
  </style>
  

</body>
</html>